---
# gccxml role - DEPRECATED, replaced by castxml
#
# gccxml is no longer maintained and does not work with modern GCC (5+).
# castxml is the official replacement and is used by modern ns-3 versions.
#
# This role now:
#   1. Installs castxml from the system package manager
#   2. Creates a compatibility symlink (optional, for legacy scripts)
#
# The apt role already installs castxml, so this role just verifies it.

- name: gccxml deprecation notice
  debug:
    msg: |
      [DEPRECATED] gccxml is replaced by castxml on Ubuntu 22.04+ / Debian 12+.
      gccxml does not work with modern GCC (5+) and is unmaintained.
      castxml is the official replacement used by modern ns-3 and pygccxml.
  tags: gccxml

- name: Ensure castxml is installed (replaces gccxml)
  apt:
    name: castxml
    state: present
  tags: gccxml

- name: Verify castxml installation
  command: "castxml --version"
  register: castxml_check
  changed_when: false
  tags: gccxml

- name: Display castxml version
  debug:
    msg: "castxml installed: {{ castxml_check.stdout_lines[0] | default('unknown') }}"
  tags: gccxml

# Legacy tasks removed:
# - Clone gccxml from GitHub (unmaintained, doesn't work with GCC 5+)
# - Build gccxml from source
# - Create /bin/gccxml symlink

# Optional: Create gccxml -> castxml symlink for legacy compatibility
# Uncomment if you have scripts that explicitly call 'gccxml'
#
# - name: Create gccxml compatibility symlink (optional)
#   file:
#     src: "/usr/bin/castxml"
#     dest: "/usr/local/bin/gccxml"
#     state: link
#   tags: gccxml