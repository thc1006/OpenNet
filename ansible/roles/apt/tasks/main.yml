---
# OpenNet Ansible APT role - modernized for Ubuntu 22.04+ / Debian 12+
#
# Changes from legacy version:
#   - Removed Taiwan mirror replacement (use default mirrors)
#   - Python 2 packages replaced with Python 3 equivalents
#   - Removed unavailable packages (gcc-4.8, qt4, python-qt4)
#   - Added castxml/pygccxml for ns-3 Python bindings
#   - Added cgroup-tools for Mininet
#
# Legacy packages removed (not available on Ubuntu 22.04+):
#   - python, python-dev, python-all -> python3, python3-dev
#   - python-setuptools -> python3-setuptools + pip3
#   - python-qt4 -> REMOVED (Qt4 EOL; use python3-pyqt5 if GUI needed)
#   - qt4-dev-tools -> qtbase5-dev, qt5-qmake
#   - gcc-4.8-multilib, g++-4.8-multilib -> gcc, g++ (system default)
#   - python-zopeinterface -> python3-zope.interface
#   - python-twisted-conch -> python3-twisted
#   - python-networkx -> python3-networkx

# NOTE: APT mirror replacement removed - use system defaults or configure separately
# - name: Replace APT source list (DISABLED - use system defaults)

- name: Update APT Cache
  apt:
    update_cache: yes
  tags: apt

- name: Install core build tools
  apt:
    name:
      - ssh
      - vim
      - tmux
      - git
      - htop
      - make
      - cmake
      - gcc
      - g++
      - build-essential
      - debhelper
      - autoconf
      - automake
      - libtool
      - patch
      - dpkg-dev
      - unzip
      - curl
      - wget
      - bzip2
      - gawk
      - texinfo
    state: present
  tags: apt

- name: Install Python 3 packages
  apt:
    name:
      - python3
      - python3-dev
      - python3-venv
      - python3-pip
      - python3-setuptools
      - python3-wheel
      - python3-networkx
      - python3-zope.interface
      - python3-twisted
    state: present
  tags: apt

- name: Install ns-3 build dependencies
  apt:
    name:
      - libboost-all-dev
      - libgsl-dev
      - libsqlite3-dev
      - libxml2-dev
      - libssl-dev
      - libpcap-dev
      - libreadline-dev
      - libncurses5-dev
      - libpcre3-dev
      - graphviz
    state: present
  tags: apt

- name: Install Qt5 for NetAnim (replaces Qt4)
  apt:
    name:
      - qtbase5-dev
      - qt5-qmake
      - qtchooser
      - libgtk-3-dev
    state: present
  tags: apt

- name: Install Python bindings tools (castxml replaces gccxml)
  apt:
    name:
      - castxml
      - python3-pygccxml
    state: present
  tags: apt

- name: Install Mininet dependencies
  apt:
    name:
      - uuid-runtime
      - cgroup-tools
    state: present
  tags: apt

- name: Install optional RDMA support (may not be available on all systems)
  apt:
    name:
      - librdmacm-dev
    state: present
  ignore_errors: yes
  tags: apt
