---
# pygccxml role - modernized for Ubuntu 22.04+ / Debian 12+
#
# Changes from legacy version:
#   - No longer downloads pygccxml 1.0.0 from SourceForge (Python 2 only)
#   - Uses system package python3-pygccxml instead
#   - No longer patches hardcoded Python 2.7 paths
#   - castxml is used instead of deprecated gccxml
#
# The apt role now installs:
#   - python3-pygccxml (Python 3 bindings)
#   - castxml (C++ parser, replaces gccxml)
#
# This role verifies the installation and prints configuration info.

- name: Verify python3-pygccxml is installed
  apt:
    name: python3-pygccxml
    state: present
  tags: pygccxml

- name: Verify castxml is installed
  apt:
    name: castxml
    state: present
  tags: pygccxml

- name: Check pygccxml version
  command: "python3 -c 'import pygccxml; print(pygccxml.__version__)'"
  register: pygccxml_version
  changed_when: false
  ignore_errors: yes
  tags: pygccxml

- name: Check castxml version
  command: "castxml --version"
  register: castxml_version
  changed_when: false
  ignore_errors: yes
  tags: pygccxml

- name: Display pygccxml installation info
  debug:
    msg: |
      pygccxml installation status:
        - pygccxml version: {{ pygccxml_version.stdout | default('not installed') }}
        - castxml version: {{ castxml_version.stdout_lines[0] | default('not installed') }}

      Note: This replaces the legacy gccxml + pygccxml 1.0.0 installation.
      ns-3 Python bindings now use castxml instead of gccxml.
  tags: pygccxml

# Legacy tasks removed:
# - Download pygccxml 1.0.0 from SourceForge (Python 2 only)
# - Patch /usr/local/lib/python2.7/dist-packages/ paths
# - Build gccxml from source
